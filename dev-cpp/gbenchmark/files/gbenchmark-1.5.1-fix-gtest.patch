From 1c76d4dac2f6702cde6975d0d9e6d4c14782b58c Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Matt=C3=A9o=20Rossillol=E2=80=91=E2=80=91Laruelle?=
 <beatussum@protonmail.com>
Date: Mon, 24 Aug 2020 14:40:37 +0200
Subject: [PATCH] fix GTest
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Use the system-wide Google testing framework (dev-cpp/gtest) instead
of downloading and building the library.

Signed-off-by: Mattéo Rossillol‑‑Laruelle <beatussum@protonmail.com>
---
 CMakeLists.txt      | 2 +-
 test/CMakeLists.txt | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 67c0b70..4b780e4 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -273,7 +273,7 @@ if (BENCHMARK_ENABLE_TESTING)
   if (BENCHMARK_ENABLE_GTEST_TESTS AND
       NOT (TARGET gtest AND TARGET gtest_main AND
            TARGET gmock AND TARGET gmock_main))
-    include(GoogleTest)
+    find_package(GTest REQUIRED CONFIG)
   endif()
   add_subdirectory(test)
 endif()
diff --git a/test/CMakeLists.txt b/test/CMakeLists.txt
index 0d228b8..30712ce 100644
--- a/test/CMakeLists.txt
+++ b/test/CMakeLists.txt
@@ -180,7 +180,7 @@ if (BENCHMARK_ENABLE_GTEST_TESTS)
   macro(compile_gtest name)
     add_executable(${name} "${name}.cc")
     target_link_libraries(${name} benchmark::benchmark
-        gmock_main ${CMAKE_THREAD_LIBS_INIT})
+        GTest::gmock_main ${CMAKE_THREAD_LIBS_INIT})
   endmacro(compile_gtest)
 
   macro(add_gtest name)
-- 
2.26.2

